<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
	<div class="home-container">
		<h2>Home Team</h2>
		Score: <b><span id="home-score">0</span></b><br>
		<button id="home-plus-1">+1</button><button id="home-minus-1">-1</button>
	</div>
	<div class="away-container">
		<h2>Away Team</h2>
		Score: <b><span id="away-score">0</span></b><br>
		<button id="away-plus-1">+1</button><button id="away-minus-1">-1</button>
	</div>

	<div class="lower-third-container">
		<h2>Lower Third Control</h2>
		Home Team Presets: <select id="home-lth-presets" onchange="setHomePreset()"></select>
		Upper Text: <input type="text" id="lth-upper-text"><br>
		Right Text: <input type="text" id="lth-bottom-text"><br>
		Secondary Text: <input type="text" id="lth-secondary-text"><br>
		<button id="lth-update">Update Lower Third</button>
	</div>

	<div class="master-container">
		<h2>Master Control</h2>
		<h3>Show Graphic:</h3>
		<div class="btn-group">
			<button onclick="lth('SCOREBUG')">Scorebug</button>
			<button onclick="lth('FINAL')">Half/Final/Break</button>
			<button onclick="lth('MATCHUP')">Matchup</button>
			<button onclick="lth('HOME_LOWER_THIRD')">Home Lower Third</button>
			<button onclick="lth('AWAY_LOWER_THIRD')">Away Lower Third</button>
			<button onclick="lth('IMAGE')">Custom Image</button>
			<button onclick="lth('NONE')">None</button>
		</div>
		<br />
		Custom Image Animation:
		<select id="image-animation" onchange="">
			<option value="fade">Fade</option>
			<option value="grow">Grow</option>
			<option value="slideUp">Slide Up</option>
			<option value="slideLeft">Slide Left</option>
			<option value="slideRight">Slide Right</option>
		</select>
		<br />
		Custom Image Presets:
		<select id="image-presets" onchange="document.getElementById('image').value = this.value">
			<option></option>
			<option value="half_stats.png">Halftime Stats</option>
			<option value="last_5_both.png">Last 5 BOTH</option>
			<option value="last_5_drexel.png">Last 5 Drexel</option>
			<option value="last_5_away.png">Last 5 Away</option>
			<!--option value="caa_standings.png">CAA Standings</option-->
			<!--option value="out_of_town.png">Out of Town Scoreboard</option-->
		</select> <br />
		Current image: <input type="text" id="image" />
		<button id="updateImage">Update Image</button>
		<br />

		<h3>Time Control: </h3>
		<b><span id="time-str">10:00</span></b><br>
		<button id="toggle-timer">Start/Stop Timer</button><br>
		Minutes: <input type="text" id="min-update"><br>
		Seconds: <input type="text" id="sec-update"><br>
		<button id="time-update">Update Time</button><br>
		Current Period: <input type="text" id="period"><br>
		<button id="updatePeriod">Update Period</button>
	</div>

	<script type="text/javascript">
		
		// NodeCG Replicants
		scoreData = nodecg.Replicant('scoreData');
		timeData = nodecg.Replicant('timeData');
		clockState = nodecg.Replicant('clockState');
		currentGraphic = nodecg.Replicant('currentGraphic');
		currentPeriod = nodecg.Replicant('currentPeriod');
		lowerThird = nodecg.Replicant('lowerThird');
		timeStr = nodecg.Replicant('timeStr');
		homeTeam = nodecg.Replicant('homeTeam');
		currentImage = nodecg.Replicant('currentImage');
		imageAnimation = nodecg.Replicant('imageAnimation');

		// Replicant Initalization
		scoreData.value = {'homeScore': 0, 'awayScore': 0};
		timeData.value = {'minutes': 30, 'seconds': 0};
		currentGraphic.value = 'NONE';
		currentPeriod.value = '1st';
		lowerThird.value = {'upperText': 'Upper Text', 'lowerText': 'Lower Text'};

		// HTML Objects
		homeScore = document.querySelector('#home-score');
		homePlusOne = document.querySelector('#home-plus-1');
		homeMinusOne = document.querySelector('#home-minus-1');

		awayScore = document.querySelector('#away-score');
		awayPlusOne = document.querySelector('#away-plus-1');
		awayMinusOne = document.querySelector('#away-minus-1');

		lowerThirdUpper = document.querySelector('#lth-upper-text');
		lowerThirdBottom = document.querySelector('#lth-bottom-text');
		lowerThirdSecondary = document.querySelector('#lth-secondary-text');
		lowerThirdUpdate = document.querySelector('#lth-update');
		homePresets = document.querySelector('#home-lth-presets');

		currentTime = document.querySelector('#time-str');
		timerToggle = document.querySelector('#toggle-timer');

		minutes = document.querySelector('#min-update');
		seconds = document.querySelector('#sec-update');
		updateTime = document.querySelector('#time-update');
		updatePeriod = document.querySelector('#updatePeriod');
		period = document.querySelector('#period');
		image = document.querySelector('#image');
		animation = document.querySelector("#image-animation")
		updateImage = document.querySelector('#updateImage');


		// Fix replicant not updating immediately bug
		let runningHomeScore = 0;
		let runningAwayScore = 0;

		// Custom Update Functions
		function lth(graphic) {
			currentGraphic.value = graphic;
		}

		// Button On Clicks
		homePlusOne.onclick = () => {
			runningHomeScore += 1;
			scoreData.value['homeScore'] = runningHomeScore;
			homeScore.innerText = runningHomeScore;
		}
		homeMinusOne.onclick = () => {
			runningHomeScore -= 1;
			scoreData.value['homeScore'] = runningHomeScore;
			homeScore.innerText = runningHomeScore;
		}
		awayPlusOne.onclick = () => {
			runningAwayScore += 1;
			scoreData.value['awayScore'] = runningAwayScore;
			homeScore.innerText = runningAwayScore;
		}
		awayMinusOne.onclick = () => {
			runningAwayScore -= 1;
			scoreData.value['awayScore'] = runningAwayScore;
			homeScore.innerText = runningAwayScore;
		}

		lowerThirdUpdate.onclick = () => {
			lowerThird.value = {'upperText': lowerThirdUpper.value, 'lowerText': lowerThirdBottom.value, 'secondaryText': lowerThirdSecondary.value};
		}

		timerToggle.onclick = () => {
			clockState.value = !clockState.value;
		}

		updateTime.onclick = () => {
			timeData.value = {'minutes': parseInt(minutes.value), 'seconds': parseInt(seconds.value)};
		}

		updatePeriod.onclick = () => {
			currentPeriod.value = period.value;
		}

		// Replicant on changes
		timeStr.on('change', (newValue, oldValue) => {
			currentTime.innerText = newValue;
		});


		updateImage.onclick = () => {
			let delay = 0;
			// prevent user error, ugly transitions by hiding image first
			if(currentGraphic.value === "IMAGE") {
				lth("NONE");
				// No animations are longer than 1.5 seconds
				delay = 1500
			}

			// delay new image from showing before animation is up
			// graphical glitch may occur if animation is not finished and user shows image
			setTimeout(function(){
				// add current time so even the SAME image will update
				currentImage.value =  image.value + "?" + new Date().getTime();
				// update image animation
				imageAnimation.value = animation.value;
			  }, delay);
		}

		homeTeam.on('change', (newValue, oldValue) => {
			homeTeam.value = newValue;
			for(player in newValue.players) {
				homePresets.options[homePresets.options.length] = new Option(player);
			}
		});

		function setHomePreset() {
			player = homePresets.options[homePresets.selectedIndex].value;
			lowerThirdUpper.value = homeTeam.value.players[player].name;
			lowerThirdBottom.value = '#' + homeTeam.value.players[player].num + ' ' + homeTeam.value.players[player].position
		}

	</script>

</body>
</html>
